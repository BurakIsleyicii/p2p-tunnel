<!--
 * @Author: snltty
 * @Date: 2021-09-11 22:51:06
 * @LastEditors: snltty
 * @LastEditTime: 2022-04-02 14:03:28
 * @version: v1.0.0
 * @Descripttion: 功能说明
 * @FilePath: \client.service.web\src\views\about\use1.md
-->

## p2p打洞tcp转发流程
1. A、B打洞成功，生成**通道1**
2. A监听**端口8000**接收连接和数据，配置转发信息 ***A 127.0.0.1:8000->B 127.0.0.1:80***
3. 浏览器访问***127.0.0.1:8000***，A **端口8000**收到<font color="green"> **数据1** </font>，通过**通道1**将<font color="green"> **数据1** </font>发送给B
4. B收到<font color="green"> **数据1** </font>，根据数据信息 连接B本地的***127.0.0.1:80***，将<font color="green"> **数据1** </font>发送给***127.0.0.1:80***
5. B 接收***127.0.0.1:80***数据，收到<font color="green"> **数据2** </font>，将<font color="green"> **数据2** </font>通过**通道1**发送给A
6. 至此，一个请求流程走完，整体表现为，浏览器访问***A端127.0.0.1:8000***，得到***B端127.0.0.1:80***的数据

<img src="./imgs/tcp-forward-p2p.png" width="100%">

## 服务端代理tcp转发流程
1. 服务端监听**端口8000**，接收连接和数据（短链接则服务端主动监听某端口，因为可以获取host来判断应该将数据发送给谁，所以只需要有限的一个或者多个端口即可，长连接则不主动监听，等待客户端注册端口监听）
2. A注册到服务器，生成**通道1**
3. A注册转发，***服务器IP:8000->B 127.0.0.1:80*** 或者 ***已解析的域名:8000->127.0.0.1:80***
3. 浏览器访问 ***服务器IP:8000*** 或者 ***已解析的域名:8000***，服务器**端口8000**收到连接，收到<font color="green"> **数据1** </font>
4. 服务器通过 **通道1** 将<font color="green"> **数据1** </font>发送给 A
4. A 收到<font color="green"> **数据1** </font>，根据数据信息连接A本地的***127.0.0.1:80***，将<font color="green"> **数据1** </font>发送给***127.0.0.1:80***
5. A 接收***127.0.0.1:80***数据，收到<font color="green"> **数据2** </font>，将<font color="green"> **数据2** </font>通过**通道1**发送给服务器
6. 至此，一个请求流程走完，整体表现为，浏览器访问***服务器IP:8000***，得到***A端127.0.0.1:80***的数据

<img src="./imgs/tcp-forward-server.png" width="100%">
